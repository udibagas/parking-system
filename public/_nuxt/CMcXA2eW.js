import{E as $}from"./kNO7pEE8.js";import{t as B,q as g,n as C}from"./Cl0b2dfg.js";import{b as O,E as S,a as U}from"./DZkOVrrl.js";import{_ as j}from"./Drqc3rNC.js";import{_ as q}from"./9Zd_WRqY.js";import"./s_4w-qWv.js";import{u as z}from"./BIbKYP8N.js";import{u as H}from"./Ct2owSWJ.js";import{r,c as F,o as J,v as K,x as c,z as s,I as d,J as W,A as m,V as G,t as Q,L as M,B as _,l as X}from"./CddAJFlS.js";import{h as T}from"./C5S46NFB.js";import"./CY9tAmGA.js";import"./Cpj98o6Y.js";import"./DrACuZyp.js";import"./4Kv7OZNC.js";import"./l0sNRNKZ.js";import"./CbPeXI4l.js";import"./CcpQkCoS.js";const Z={class:"flex",style:{"padding-bottom":"10px","margin-bottom":"40px"}},ee=c("div",{class:"ml-3 flex-grow",style:{"font-size":"1.3rem","font-weight":"bold"}}," LAPORAN ",-1),ae={class:"mr-2"},te=["innerHTML"],Ye={__name:"report",setup(ne){const f=H(),l=z(),D=X(),v=r([]),R=r([]),P=r([]),h=r([]),u=r(!1),a=r([T().format("YYYY-MM-01"),T().format("YYYY-MM-DD")]),w=r(null);F(()=>f.areaParkirList);const Y=(t=null)=>{if(t==null){const e=new URLSearchParams;e.append("action","print"),e.append("dateRange[]",a.value[0]),e.append("dateRange[]",a.value[1]),window.open(`${D.public.apiBase}/api/report?${e}`,"_blank")}else l("api/report",{params:{action:"print",printer_id:t,"dateRange[0]":a.value[0],"dateRange[1]":a.value[1]}}).then(e=>{B({message:e.message,type:"success"})}).finally(()=>{u.value=!1})},b=()=>{l("/api/getTransaction",{params:{"dateRange[0]":a.value[0],"dateRange[1]":a.value[1]}}).then(t=>{v.value=t;let e=t.map(o=>o.total).reduce((o,n)=>o+parseInt(n),0);v.value.push({jenis_kendaraan:"TOTAL",total:e})})},V=()=>{l("/api/getIncome",{params:{"dateRange[0]":a.value[0],"dateRange[1]":a.value[1]}}).then(t=>{R.value=t;let e=t.map(n=>Number(n.total)).reduce((n,i)=>n+Number(i),0),o=t.map(n=>Number(n.denda)).reduce((n,i)=>n+Number(i),0);R.value.push({jenis_kendaraan:"TOTAL",total:e,denda:o})})},y=async()=>{const t=await l("/api/getParkedVehicle",{params:{"dateRange[0]":a.value[0],"dateRange[1]":a.value[1]}});P.value=t},A=()=>{l("/api/getVehicleIn",{params:{"dateRange[0]":a.value[0],"dateRange[1]":a.value[1]}}).then(t=>{h.value=t;let e=t.map(o=>o.total).reduce((o,n)=>o+parseInt(n),0);h.value.push({gate:"TOTAL",total:e})})},I=()=>{l("/api/report",{params:{"dateRange[0]":a.value[0],"dateRange[1]":a.value[1]}}).then(t=>w.value=t)},k=async()=>{await f.getAreaParkirList(),b(),V(),y(),A(),I()};return J(()=>{k()}),(t,e)=>{const o=$,n=C,i=S,L=U,x=O,E=j,N=q;return Q(),K(G,null,[c("div",Z,[ee,c("div",ae,[s(o,{class:"mr-3",onChange:k,modelValue:d(a),"onUpdate:modelValue":e[0]||(e[0]=p=>W(a)?a.value=p:null),format:"DD/MMM/YYYY","value-format":"YYYY-MM-DD",type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date"},null,8,["modelValue"])]),s(x,{"split-button":"",type:"primary"},{dropdown:m(()=>[s(L,null,{default:m(()=>[s(i,{icon:d(g),onClick:e[1]||(e[1]=M(p=>Y(null),["prevent"]))},{default:m(()=>[_(" A4 ")]),_:1},8,["icon"]),s(i,{icon:d(g),onClick:e[2]||(e[2]=M(p=>u.value=!0,["prevent"]))},{default:m(()=>[_(" STRUK ")]),_:1},8,["icon"])]),_:1})]),default:m(()=>[s(n,{class:"mr-2"},{default:m(()=>[s(d(g))]),_:1}),_(" PRINT LAPORAN ")]),_:1})]),c("div",{style:{padding:"0 20px"},innerHTML:d(w)},null,8,te),s(E),s(N,{show:d(u),onPrint:e[3]||(e[3]=p=>Y(p)),onClose:e[4]||(e[4]=p=>u.value=!1)},null,8,["show"])],64)}}};export{Ye as default};
